<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Murajah Quiz</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="resources/favicon.ico">
  
    <!-- Vue 3 Production -->
    <script src="resources/js/vue.global.js"></script>
    <!-- Tailwind CSS -->
    <script src="resources/js/tailwind.3.4.7.js"></script>
    <!-- Custom Styles -->
    <style>
        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --light-bg: #ffffff;
            --light-text: #111827;
            --dark-bg: #111827;
            --dark-text: #f3f4f6;
            --card-light: #ffffff;
            --color-primary: #2196f3;
            --color-secondary: #1976d2;
            --color-accent: #82b1ff;
        }
        
        /* Light mode defaults */
        html {
            background-color: var(--light-bg);
            color: var(--light-text);
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--light-text);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* Dark mode */
        html.dark,
        html.dark-mode,
        body.dark {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }
        
        /* Custom utility classes */
        .bg-primary { background-color: var(--color-primary); }
        .text-primary { color: var(--color-primary); }
        .border-primary { border-color: var(--color-primary); }
        
        .bg-secondary { background-color: var(--color-secondary); }
        .text-secondary { color: var(--color-secondary); }
        
        .bg-accent { background-color: var(--color-accent); }
        .text-accent { color: var(--color-accent); }

        /* Dark mode overrides - Core backgrounds */
        .dark,
        .dark-mode {
            background-color: var(--dark-bg) !important;
            color: var(--dark-text) !important;
        }

        /* Header and main content backgrounds */
        .dark header {
            background-color: var(--card-dark) !important;
            color: var(--dark-text) !important;
        }

        .dark main {
            background-color: var(--dark-bg) !important;
            color: var(--dark-text) !important;
        }

        .dark footer {
            background-color: #0f172a !important;
            color: var(--dark-text) !important;
        }

        /* Generic background color overrides */
        .dark .bg-white { background-color: var(--card-dark) !important; color: var(--dark-text) !important; }
        .dark .bg-gray-50 { background-color: var(--dark-bg) !important; color: var(--dark-text) !important; }
        .dark .bg-gray-100 { background-color: var(--card-dark) !important; color: var(--dark-text) !important; }
        .dark .bg-gray-200 { background-color: #374151 !important; color: var(--dark-text) !important; }
        .dark .bg-gray-700 { background-color: #1f2937 !important; color: var(--dark-text) !important; }
        .dark .bg-gray-800 { background-color: var(--card-dark) !important; color: var(--dark-text) !important; }
        .dark .bg-gray-900 { background-color: #0f172a !important; color: var(--dark-text) !important; }
        .dark .bg-gray-950 { background-color: var(--dark-bg) !important; color: var(--dark-text) !important; }
        
        /* Color-specific background overrides */
        .dark .bg-blue-50 { background-color: rgba(30, 58, 138, 0.4) !important; }
        .dark .bg-green-50 { background-color: rgba(20, 83, 45, 0.4) !important; }
        .dark .bg-orange-50 { background-color: rgba(124, 45, 18, 0.4) !important; }
        .dark .bg-amber-50 { background-color: rgba(120, 53, 15, 0.4) !important; }
        .dark .bg-pink-50 { background-color: rgba(131, 24, 67, 0.4) !important; }
        .dark .bg-purple-50 { background-color: rgba(88, 28, 135, 0.4) !important; }
        .dark .bg-cyan-50 { background-color: rgba(21, 94, 109, 0.4) !important; }
        .dark .bg-red-100 { background-color: rgba(127, 29, 29, 0.8) !important; }
        .dark .bg-red-200 { background-color: rgba(153, 27, 27, 0.8) !important; }
        .dark .bg-green-100 { background-color: rgba(20, 83, 45, 0.8) !important; }
        .dark .bg-green-200 { background-color: rgba(34, 110, 59, 0.8) !important; }
        .dark .bg-blue-100 { background-color: rgba(30, 58, 138, 0.6) !important; }
        .dark .bg-blue-200 { background-color: rgba(30, 58, 138, 0.7) !important; }
        .dark .bg-yellow-100 { background-color: rgba(120, 53, 15, 0.6) !important; }
        .dark .bg-yellow-200 { background-color: rgba(120, 53, 15, 0.7) !important; }

        /* Ensure text color is readable on light background colors in dark mode */
        .dark .bg-blue-50,
        .dark .bg-green-50,
        .dark .bg-orange-50,
        .dark .bg-amber-50,
        .dark .bg-pink-50,
        .dark .bg-purple-50,
        .dark .bg-cyan-50,
        .dark .bg-blue-100,
        .dark .bg-blue-200,
        .dark .bg-yellow-100,
        .dark .bg-yellow-200 {
            color: var(--dark-text) !important;
        }

        .dark .bg-blue-50 button,
        .dark .bg-green-50 button,
        .dark .bg-orange-50 button,
        .dark .bg-amber-50 button,
        .dark .bg-pink-50 button,
        .dark .bg-purple-50 button,
        .dark .bg-cyan-50 button,
        .dark .bg-blue-100 button,
        .dark .bg-blue-200 button,
        .dark .bg-yellow-100 button,
        .dark .bg-yellow-200 button {
            color: white !important;
        }

        /* Text color overrides for dark mode readability */
        .dark .text-gray-900 { color: var(--dark-text) !important; }
        .dark .text-gray-800 { color: #e5e7eb !important; }
        .dark .text-gray-700 { color: #d1d5db !important; }
        .dark .text-gray-600 { color: #e5e7eb !important; }
        .dark .text-gray-500 { color: #d1d5db !important; }
        .dark .text-gray-400 { color: #9ca3af !important; }
        .dark .text-gray-300 { color: #d1d5db !important; }
        .dark .text-gray-200 { color: #e5e7eb !important; }
        .dark .text-gray-100 { color: #f3f4f6 !important; }
        
        /* Colored text in dark mode */
        .dark .text-blue-900 { color: #93c5fd !important; }
        .dark .text-blue-800 { color: #bfdbfe !important; }
        .dark .text-blue-700 { color: #93c5fd !important; }
        .dark .text-green-900 { color: #86efac !important; }
        .dark .text-green-800 { color: #bbf7d0 !important; }
        .dark .text-green-700 { color: #86efac !important; }
        .dark .text-red-900 { color: #fca5a5 !important; }
        .dark .text-red-800 { color: #fecaca !important; }
        .dark .text-red-700 { color: #fca5a5 !important; }
        .dark .text-red-200 { color: #fecaca !important; }
        .dark .text-orange-900 { color: #fed7aa !important; }
        .dark .text-orange-800 { color: #fecaca !important; }
        .dark .text-amber-900 { color: #fef3c7 !important; }
        .dark .text-amber-800 { color: #fde68a !important; }
        .dark .text-pink-900 { color: #fbcfe8 !important; }
        .dark .text-pink-700 { color: #fbcfe8 !important; }
        .dark .text-purple-900 { color: #e9d5ff !important; }
        .dark .text-purple-700 { color: #e9d5ff !important; }
        .dark .text-cyan-900 { color: #a5f3fc !important; }
        .dark .text-green-200 { color: #bbf7d0 !important; }
        
        /* Border colors for dark mode */
        .dark .border-gray-200 { border-color: #374151 !important; }
        .dark .border-gray-300 { border-color: #4b5563 !important; }
        .dark .border-white { border-color: #e5e7eb !important; }
        .dark .border-gray-700 { border-color: #4b5563 !important; }
        
        /* Button and form element styling in dark mode */
        .dark button:not([class*="bg-"]) { background-color: #374151 !important; color: var(--dark-text) !important; }
        .dark input { background-color: #374151 !important; color: var(--dark-text) !important; border-color: #4b5563 !important; }
        .dark textarea { background-color: #374151 !important; color: var(--dark-text) !important; border-color: #4b5563 !important; }
        .dark select { background-color: #374151 !important; color: var(--dark-text) !important; border-color: #4b5563 !important; }

        /* Button text color fixes for dark mode - ensure white text on colored backgrounds */
        .dark .bg-primary,
        .dark .bg-secondary,
        .dark .bg-accent,
        .dark .bg-blue-500,
        .dark .bg-blue-600,
        .dark .bg-green-600,
        .dark .bg-red-600,
        .dark .bg-purple-600,
        .dark .bg-yellow-600,
        .dark .bg-orange-600,
        .dark .bg-gray-600 {
            color: white !important;
        }

        .dark .bg-primary span,
        .dark .bg-secondary span,
        .dark .bg-accent span,
        .dark .bg-blue-500 span,
        .dark .bg-blue-600 span,
        .dark .bg-green-600 span,
        .dark .bg-red-600 span,
        .dark .bg-purple-600 span,
        .dark .bg-yellow-600 span,
        .dark .bg-orange-600 span,
        .dark .bg-gray-600 span {
            color: white !important;
        }

        .dark .bg-primary i,
        .dark .bg-secondary i,
        .dark .bg-accent i,
        .dark .bg-blue-500 i,
        .dark .bg-blue-600 i,
        .dark .bg-green-600 i,
        .dark .bg-red-600 i,
        .dark .bg-purple-600 i,
        .dark .bg-yellow-600 i,
        .dark .bg-orange-600 i,
        .dark .bg-gray-600 i {
            color: white !important;
        }

        /* Typography in dark mode */
        .dark h1,
        .dark h2,
        .dark h3,
        .dark h4,
        .dark h5,
        .dark h6 {
            color: var(--dark-text) !important;
        }

        .dark p { color: #e5e7eb !important; }
        .dark strong { color: #ffffff !important; }
        .dark li { color: #e5e7eb !important; }
        .dark a { color: #93c5fd !important; }
        .dark a:hover { color: #bfdbfe !important; }

        /* Tables in dark mode */
        .dark table { color: #e5e7eb !important; }
        .dark tr { color: #e5e7eb !important; }
        .dark td { color: #e5e7eb !important; }
        .dark th { color: var(--dark-text) !important; background-color: #2d3748 !important; }

        /* Gradient backgrounds in dark mode */
        .dark .bg-gradient-to-r,
        .dark .bg-gradient-to-l,
        .dark .bg-gradient-to-t,
        .dark .bg-gradient-to-b,
        .dark .bg-gradient-to-br,
        .dark .bg-gradient-to-tl {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(168, 85, 247, 0.3)) !important;
        }

        /* Shadow in dark mode */
        .dark .shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.8) !important; }
        .dark .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.9) !important; }
        .dark .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.8) !important; }

        /* Loading overlay in dark mode */
        .dark .bg-opacity-50 { background-color: rgba(0, 0, 0, 0.75) !important; }
        .dark .bg-gray-900 { background-color: rgba(0, 0, 0, 0.9) !important; }

        /* Loading overlay in dark mode */
        .dark .bg-opacity-50 { background-color: rgba(0, 0, 0, 0.75) !important; }
        .dark .bg-gray-900 { background-color: rgba(0, 0, 0, 0.9) !important; }

        /* Ensure proper color inheritance in dark mode */
        .dark > * { color: inherit; }
        .dark * { color-scheme: dark; }

        /* Modal and overlay styling */
        .bg-white[class*="p-6"][class*="rounded-lg"] {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .dark .bg-white[class*="p-6"][class*="rounded-lg"] {
            background-color: var(--card-dark) !important;
            color: var(--dark-text) !important;
        }

        /* Error message styling */
        .bg-red-100 {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .dark .bg-red-100 {
            background-color: rgba(127, 29, 29, 0.8) !important;
            border-color: rgba(244, 63, 94, 0.6) !important;
            color: #fca5a5 !important;
        }

        .dark .border-red-400 {
            border-color: rgba(244, 63, 94, 0.6) !important;
        }

        .dark .text-red-700 {
            color: #fca5a5 !important;
        }

        /* Ensure spinner colors are visible in dark mode */
        .dark .border-primary {
            border-color: var(--color-primary) !important;
        }

        .dark .text-gray-600 {
            color: #e5e7eb !important;
        }

        /* ===== EXPLICIT LIGHT MODE RESETS ===== */
        /* Ensure elements revert to light mode when .dark class is removed */
        
        /* Light mode background colors */
        body:not(.dark) .bg-white { background-color: #ffffff !important; color: #111827 !important; }
        body:not(.dark) .bg-gray-50 { background-color: #f9fafb !important; color: #111827 !important; }
        body:not(.dark) .bg-gray-100 { background-color: #f3f4f6 !important; color: #111827 !important; }
        body:not(.dark) .bg-gray-200 { background-color: #e5e7eb !important; color: #111827 !important; }
        body:not(.dark) .bg-gray-700 { background-color: #374151 !important; }
        body:not(.dark) .bg-gray-800 { background-color: #1f2937 !important; }
        body:not(.dark) .bg-gray-900 { background-color: #111827 !important; }
        
        /* Light mode text colors */
        body:not(.dark) .text-gray-900 { color: #111827 !important; }
        body:not(.dark) .text-gray-800 { color: #1f2937 !important; }
        body:not(.dark) .text-gray-700 { color: #374151 !important; }
        body:not(.dark) .text-gray-600 { color: #4b5563 !important; }
        body:not(.dark) .text-gray-500 { color: #6b7280 !important; }
        body:not(.dark) .text-gray-400 { color: #9ca3af !important; }
        body:not(.dark) .text-gray-300 { color: #d1d5db !important; }
        body:not(.dark) .text-gray-200 { color: #e5e7eb !important; }
        body:not(.dark) .text-gray-100 { color: #f3f4f6 !important; }
        
        /* Light mode header/footer */
        body:not(.dark) header { background-color: #ffffff !important; color: #111827 !important; }
        body:not(.dark) footer { background-color: #111827 !important; color: #9ca3af !important; }
        body:not(.dark) main { background-color: inherit !important; color: #111827 !important; }
        
        /* Light mode inputs/selects */
        body:not(.dark) input { background-color: #ffffff !important; color: #111827 !important; border-color: #d1d5db !important; }
        body:not(.dark) textarea { background-color: #ffffff !important; color: #111827 !important; border-color: #d1d5db !important; }
        body:not(.dark) select { background-color: #ffffff !important; color: #111827 !important; border-color: #d1d5db !important; }
        
        /* Light mode buttons */
        body:not(.dark) button:not([class*="bg-"]) { background-color: #f3f4f6 !important; color: #111827 !important; }
        
        /* Light mode colored text */
        body:not(.dark) .text-blue-900 { color: #1e3a8a !important; }
        body:not(.dark) .text-blue-800 { color: #1e40af !important; }
        body:not(.dark) .text-green-900 { color: #14532d !important; }
        body:not(.dark) .text-green-800 { color: #166534 !important; }
        body:not(.dark) .text-red-900 { color: #7f1d1d !important; }
        body:not(.dark) .text-red-800 { color: #991b1b !important; }
        body:not(.dark) .text-red-700 { color: #b91c1c !important; }
        body:not(.dark) .text-red-200 { color: #fecaca !important; }
        
        /* Light mode borders */
        body:not(.dark) .border-gray-200 { border-color: #e5e7eb !important; }
        body:not(.dark) .border-gray-300 { border-color: #d1d5db !important; }
        body:not(.dark) .border-gray-700 { border-color: #374151 !important; }
        
        /* Light mode modal styling */
        body:not(.dark) .bg-white[class*="p-6"][class*="rounded-lg"] { background-color: #ffffff !important; color: #111827 !important; }
        
        /* Light mode error messages */
        body:not(.dark) .bg-red-100 { background-color: #fee2e2 !important; border-color: #fca5a5 !important; color: #7f1d1d !important; }
        body:not(.dark) .border-red-400 { border-color: #f87171 !important; }
        
        /* Ensure all elements in light mode have correct text color */
        body:not(.dark) h1,
        body:not(.dark) h2,
        body:not(.dark) h3,
        body:not(.dark) h4,
        body:not(.dark) h5,
        body:not(.dark) h6 {
            color: #111827 !important;
        }
        
        body:not(.dark) p { color: #374151 !important; }
        body:not(.dark) strong { color: #111827 !important; }
        body:not(.dark) li { color: #374151 !important; }
        body:not(.dark) a { color: #2563eb !important; }
        body:not(.dark) a:hover { color: #1d4ed8 !important; }

        /* ===== RESPONSIVE TABS ===== */
        /* Tab navigation container */
        nav[aria-label="Quiz Types"] {
            display: flex;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }

        /* Desktop tabs (>640px) */
        @media (min-width: 641px) {
            nav[aria-label="Quiz Types"] {
                gap: 2rem; /* space-x-8 */
            }

            nav[aria-label="Quiz Types"] button {
                padding: 1rem 0.25rem;
                font-size: 0.875rem;
                white-space: nowrap;
                flex-shrink: 0;
            }
        }

        /* Tablet tabs (500px - 640px) */
        @media (max-width: 640px) and (min-width: 501px) {
            nav[aria-label="Quiz Types"] {
                gap: 0.75rem; /* Reduced gap */
            }

            nav[aria-label="Quiz Types"] button {
                padding: 0.75rem 0.5rem;
                font-size: 0.75rem;
                white-space: nowrap;
                flex-shrink: 0;
            }
        }

        /* Mobile tabs (<500px) */
        @media (max-width: 500px) {
            nav[aria-label="Quiz Types"] {
                gap: 0.5rem; /* Minimal gap */
            }

            nav[aria-label="Quiz Types"] button {
                padding: 0.5rem 0.4rem;
                font-size: 0.65rem;
                white-space: nowrap;
                flex-shrink: 0;
            }
        }

        /* Hide scrollbar but keep scrolling functional */
        nav[aria-label="Quiz Types"]::-webkit-scrollbar {
            height: 2px;
        }

        nav[aria-label="Quiz Types"]::-webkit-scrollbar-track {
            background: transparent;
        }

        nav[aria-label="Quiz Types"]::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.5);
            border-radius: 4px;
        }

        nav[aria-label="Quiz Types"]::-webkit-scrollbar-thumb:hover {
            background: rgba(156, 163, 175, 0.8);
        }

        /* ===== DISABLE HOVER/TOOLTIPS ON TOUCH DEVICES ===== */
        /* Use @media (hover: none) to detect touch devices without hover capability */
        @media (hover: none) and (pointer: coarse) {
            /* Disable all hover effects on touch devices */
            *:hover {
                background-color: inherit !important;
                color: inherit !important;
                border-color: inherit !important;
            }

            /* Disable hover scale transformations */
            *:hover {
                transform: none !important;
            }

            /* Disable hover border changes */
            button:hover,
            a:hover,
            .hover\:border-primary:hover,
            .hover\:bg-blue-50:hover {
                border-color: inherit !important;
                background-color: inherit !important;
            }

            /* Prevent tooltips from showing on touch */
            [data-tooltip],
            .tooltip,
            [title] {
                pointer-events: none;
            }

            /* Disable all active/focus states that might trigger tooltips */
            *:active {
                background-color: inherit !important;
            }
        }

        /* Alternative: Use pointer-events to disable hover tooltips on all touch-capable devices */
        @supports (pointer: coarse) {
            @media (pointer: coarse) {
                /* Hide any tooltip-like elements on touch devices */
                [role="tooltip"],
                .word-tooltip,
                .translation-tooltip {
                    display: none !important;
                }
            }
        }
    </style>
</head>
<body class="bg-gray-50 ">
    <div id="app" class="min-h-screen">
        <!-- Loading Overlay -->
        <div v-if="isLoading" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
                <p class="mt-4 text-gray-600">Loading...</p>
            </div>
        </div>

        <!-- Error Message -->
        <div v-if="error" class="fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50">
            <p class="flex items-center">
                <span class="mr-2">⚠️</span>
                {{ error }}
            </p>
        </div>

        <!-- Header -->
        <header class="bg-white shadow ">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold text-gray-900 "><img src="resources/logo-bg.png" class="h-25 rounded-lg" ></h1>
                    <nav class="flex items-center gap-6 mr-4">
                        <a href="./index.html" class="text-gray-700  hover:text-blue-600  font-medium transition-colors">Memorize</a>
                        <a href="./quiz.html" class="text-gray-700  hover:text-blue-600  font-medium transition-colors">Quiz</a>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Quiz Type Tabs -->
            <div class="mb-8">
                <div class="border-b border-gray-200 ">
                    <nav class="-mb-px flex space-x-8" aria-label="Quiz Types">
                        <button 
                            v-for="tab in tabs" 
                            :key="tab.id"
                            @click="currentTab = tab.id"
                            :class="[
                                currentTab === tab.id
                                    ? 'border-primary text-primary rounded-lg'
                                    : 'border-transparent text-gray-500  hover:text-gray-700  hover:border-gray-300 rounded-lg',
                                'whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm'
                            ]"
                        >
                            {{ tab.name }}
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Quiz Content Area -->
            <div class="bg-white  rounded-lg shadow p-6">
                <!-- Welcome/Tutorial Section (shown initially) -->
                <div v-if="!selectedSurahs.length && currentTab !== 'config'" class="space-y-8">
                    <div class="text-center mb-8">
                        <h2 class="text-4xl font-bold text-gray-900  mb-2">Welcome to Murajah Quiz! 📖</h2>
                        <p class="text-lg text-gray-600 ">Master the Quran through interactive quizzes</p>
                    </div>

                    <div class="bg-blue-50  border-l-4 border-blue-500 p-6 rounded mb-8">
                        <h3 class="text-xl font-semibold text-blue-900  mb-2">🎯 Getting Started</h3>
                        <p class="text-blue-800  mb-4">Before you start, please select the surahs you want to practice:</p>
                        <button @click="currentTab = 'config'" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold transition">
                            ⚙️ Go to Settings
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Lightning Round Card -->
                        <div class="border-2 border-gray-200  rounded-lg p-6 hover:border-primary transition">
                            <h3 class="text-2xl font-bold text-primary mb-2">⚡ Lightning Round</h3>
                            <p class="text-gray-600  mb-4">
                                Race against the clock! Select your time limit (60s to 5min) and difficulty level (Easy/Medium/Hard). Questions alternate between "Next/Previous Verse" and "Translation" to keep you sharp.
                            </p>
                            <div class="bg-gray-100  p-4 rounded text-sm space-y-2">
                                <p>⏱️ <strong>Timed Challenge:</strong> Beat the clock</p>
                                <p>📊 <strong>Mixed Questions:</strong> Verse continuity + translation</p>
                                <p>🎯 <strong>Difficulty Levels:</strong> Affects mistake limits</p>
                            </div>
                        </div>

                        <!-- Verse Completion Card -->
                        <div class="border-2 border-gray-200  rounded-lg p-6 hover:border-primary transition">
                            <h3 class="text-2xl font-bold text-primary mb-2">📝 Verse Completion</h3>
                            <p class="text-gray-600  mb-4">
                                Fill in the missing words! A verse appears with 2-5 words blanked out. Click on the correct words in sequence to fill the blanks.
                            </p>
                            <div class="bg-gray-100  p-4 rounded text-sm space-y-2">
                                <p>🎲 <strong>Random Blanks:</strong> 2-5 words per verse</p>
                                <p>⬅️ <strong>Fill Right to Left:</strong> Select words to complete</p>
                                <p>✅ <strong>Instant Feedback:</strong> Know if you're right</p>
                            </div>
                        </div>

                        <!-- Test Continuation Card -->
                        <div class="border-2 border-gray-200  rounded-lg p-6 hover:border-primary transition">
                            <h3 class="text-2xl font-bold text-primary mb-2">🔗 Test Continuation</h3>
                            <p class="text-gray-600  mb-4">
                                Know your verses! A verse is shown, and you must select either the NEXT or PREVIOUS verse from four options.
                            </p>
                            <div class="bg-gray-100  p-4 rounded text-sm space-y-2">
                                <p>⬇️⬆️ <strong>Next or Previous:</strong> Badge shows which one</p>
                                <p>🎯 <strong>Multiple Choice:</strong> 4 options per question</p>
                                <p>📈 <strong>Track Progress:</strong> Score and streak</p>
                            </div>
                        </div>

                        <!-- Translation Match Card -->
                        <div class="border-2 border-gray-200  rounded-lg p-6 hover:border-primary transition">
                            <h3 class="text-2xl font-bold text-primary mb-2">🌐 Translation Match</h3>
                            <p class="text-gray-600  mb-4">
                                Match verses with meanings! A Quranic verse is shown in Arabic. Choose the correct English translation from four options.
                            </p>
                            <div class="bg-gray-100  p-4 rounded text-sm space-y-2">
                                <p>📖 <strong>Arabic to English:</strong> Test your understanding</p>
                                <p>🎯 <strong>Multiple Choice:</strong> 4 translation options</p>
                                <p>🏆 <strong>Build Mastery:</strong> Learn meanings deeply</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-green-50  border-l-4 border-green-500 p-6 rounded text-center">
                        <p class="text-green-800  text-lg font-semibold">
                            ✨ Select your surahs in Settings to begin your journey! ✨
                        </p>
                    </div>
                </div>

                <!-- Lightning Round -->
                <div v-else-if="currentTab === 'lightning-round'" class="space-y-6">
                    <!-- Selection Screen (before starting) -->
                    <div v-if="!lightningIsActive && !lightningRoundEnded">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-primary mb-2">⚡ Lightning Round</h2>
                            <p class="text-gray-600  text-lg">Answer as many questions as you can before time runs out!</p>
                        </div>

                        <!-- Time Selection -->
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold mb-4">Select Duration:</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <button v-for="time in [60, 120, 180, 300]" :key="time"
                                    @click="lightningSelectedTime = time"
                                    :class="[
                                        'py-4 px-4 rounded-lg font-semibold text-lg transition-all border-2',
                                        lightningSelectedTime === time
                                            ? 'bg-primary text-white border-primary scale-105'
                                            : 'bg-gray-100  text-gray-700  border-gray-300  hover:border-primary'
                                    ]">
                                    {{ time === 60 ? '60s' : time === 120 ? '2 min' : time === 180 ? '3 min' : '5 min' }}
                                </button>
                            </div>
                        </div>

                        <!-- Difficulty Selection -->
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold mb-4">Select Difficulty:</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button v-for="diff in ['easy', 'medium', 'hard']" :key="diff"
                                    @click="lightningSelectedDifficulty = diff"
                                    :class="[
                                        'py-4 px-4 rounded-lg font-semibold text-lg transition-all border-2',
                                        lightningSelectedDifficulty === diff
                                            ? 'bg-primary text-white border-primary scale-105'
                                            : 'bg-gray-100  text-gray-700  border-gray-300  hover:border-primary'
                                    ]">
                                    <span class="mr-2">
                                        {{ diff === 'easy' ? '🟢' : diff === 'medium' ? '🟡' : '🔴' }}
                                    </span>
                                    {{ diff.charAt(0).toUpperCase() + diff.slice(1) }}
                                    <div class="text-xs mt-1">
                                        {{ diff === 'easy' ? '❌ Ignored' : diff === 'medium' ? '3 Max' : '1 Stop' }}
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Start Button -->
                        <div class="text-center">
                            <button @click="startLightningRound"
                                :disabled="!lightningSelectedTime || !lightningSelectedDifficulty"
                                :class="[
                                    'px-8 py-4 rounded-lg font-bold text-lg transition-all',
                                    lightningSelectedTime && lightningSelectedDifficulty
                                        ? 'bg-primary text-white hover:bg-secondary cursor-pointer'
                                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                ]">
                                🚀 Start Round
                            </button>
                        </div>
                    </div>

                    <!-- Active Round Display -->
                    <div v-else-if="lightningIsActive" class="space-y-6">
                        <!-- Timer and Stats Header -->
                        <div class="flex justify-between items-center bg-gradient-to-r from-primary to-secondary p-6 rounded-lg text-white">
                            <div>
                                <p class="text-sm opacity-90">Time Remaining</p>
                                <p class="text-4xl font-bold font-mono text-white" :class="lightningTimeLeft <= 10 ? 'text-red-300 animate-pulse' : ''">
                                    {{ Math.floor(lightningTimeLeft / 60) }}:{{ String(lightningTimeLeft % 60).padStart(2, '0') }}
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-lg text-white">Score: <span class="font-bold text-2xl">{{ lightningScore }}/{{ lightningAttempts }}</span></p>
                                <p class="text-lg mt-2 text-white" :class="lightningMistakesLeft <= 1 ? 'text-red-300' : ''">
                                    {{ lightningSelectedDifficulty === 'easy' ? '♾️ No Limit' : `❌ ${lightningMistakesLeft} Mistakes` }}
                                </p>
                            </div>
                        </div>

                        <!-- Question Display -->
                        <div v-if="lightningCurrentQuestion" class="space-y-4">
                            <div class="text-center mb-6">
                                <span class="inline-block bg-accent text-white px-4 py-2 rounded-full text-sm font-semibold">
                                    {{ lightningCurrentQuestionType === 'continuation' 
                                        ? (lightningCurrentQuestion.type === 'next' ? '⬇️ Next Verse' : '⬆️ Previous Verse')
                                        : '📖 Translation' 
                                    }}
                                </span>
                            </div>

                            <!-- Question Text -->
                            <div class="p-6 bg-gray-50  rounded-lg">
                                <p class="text-2xl text-right font-arabic" style="line-height: 2;">{{ lightningCurrentQuestion.text }}</p>
                                <p class="text-sm text-gray-500  mt-2">
                                    Surah {{ lightningCurrentQuestion.chapter }}, Verse {{ lightningCurrentQuestion.verse }}
                                </p>
                            </div>

                            <!-- Answer Options -->
                            <div class="grid gap-3">
                                <button v-for="(option, index) in lightningOptions" :key="index"
                                    @click="checkLightningAnswer(index)"
                                    :disabled="lightningAnswerRevealed"
                                    :class="[
                                        'p-4 rounded-lg text-left transition-all border-2',
                                        lightningAnswerRevealed
                                            ? (option.isCorrect 
                                                ? 'bg-green-100  border-green-500 text-green-700 ' 
                                                : 'bg-gray-100  border-gray-300 text-gray-600 ')
                                            : 'bg-white  border-gray-300  hover:border-primary hover:bg-blue-50 '
                                    ]">
                                    <p class="font-medium text-right font-arabic" style="line-height: 1.6;">{{ option.text }}</p>
                                </button>
                            </div>

                            <!-- Feedback -->
                            <div v-if="lightningAnswerRevealed" class="text-center">
                                <div v-if="lightningAnswerIsCorrect" class="text-green-600 font-bold text-lg">
                                    ✅ Correct!
                                </div>
                                <div v-else class="text-red-600 font-bold text-lg">
                                    ❌ Incorrect!
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Round End Summary -->
                    <div v-else-if="lightningRoundEnded" class="text-center space-y-6">
                        <h2 class="text-3xl font-bold text-gray-900 ">Round Complete! 🎉</h2>
                        <div class="bg-gradient-to-br from-primary/10 to-secondary/10   rounded-lg p-8 space-y-4">
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                <div>
                                    <p class="text-sm text-gray-600 ">Final Score</p>
                                    <p class="text-3xl font-bold text-primary">{{ lightningScore }}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 ">Questions</p>
                                    <p class="text-3xl font-bold text-gray-900 ">{{ lightningAttempts }}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 ">Accuracy</p>
                                    <p class="text-3xl font-bold text-green-500">{{ lightningAttempts ? Math.round((lightningScore / lightningAttempts) * 100) : 0 }}%</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 ">Difficulty</p>
                                    <p class="text-2xl font-bold text-gray-900 ">{{ lightningSelectedDifficulty.toUpperCase() }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-4 justify-center">
                            <button @click="resetLightningRound" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-secondary font-semibold">
                                Play Again
                            </button>
                            <button @click="saveLightningScore" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                                Save Score
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Verse Completion -->
                <div v-if="currentTab === 'verse-completion'" class="space-y-6">
                    <!-- Header with Score -->
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-3xl font-bold text-primary mb-1">📝 Verse Completion</h2>
                            <p class="text-gray-600 ">Fill in the missing words to complete the verse</p>
                            <!-- Start Button -->
                            <div v-if="!completionVerse && !isLoading && selectedSurahs.length" class="mt-4">
                                <button @click="generateCompletionQuestion" class="px-6 py-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-lg font-bold hover:from-pink-600 hover:to-purple-600 transition transform hover:scale-105">
                                    🚀 Start
                                </button>
                            </div>
                        </div>
                        
                        <!-- Score Display -->
                        <div class="text-right">
                            <div class="bg-gray-100  rounded-lg p-4">
                                <div class="mb-2">
                                    <p class="text-sm text-gray-600 ">Score</p>
                                    <p class="text-2xl font-bold text-primary">
                                        {{ completionScore }}/{{ completionAttempts }}
                                        <span class="text-sm text-gray-500">
                                            ({{ completionAttempts ? Math.round((completionScore/completionAttempts) * 100) : 0 }}%)
                                        </span>
                                    </p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 ">Current Streak</p>
                                    <p class="text-xl font-bold" :class="completionStreak >= 5 ? 'text-green-500' : 'text-gray-700 '">
                                        {{ completionStreak }} 🔥
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tutorial Section (shown before quiz starts) -->
                    <div v-if="!completionVerse && !isLoading && selectedSurahs.length" class="space-y-6">
                        <div class="bg-gradient-to-r from-pink-50 to-purple-50   border-2 border-pink-200  rounded-lg p-8">
                            <h3 class="text-2xl font-bold text-pink-700  mb-4">How It Works 🎯</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="text-center">
                                    <div class="text-4xl mb-3">1️⃣</div>
                                    <h4 class="font-semibold text-gray-900  mb-2">A Verse Appears</h4>
                                    <p class="text-sm text-gray-700 ">A Quranic verse is displayed with 2-5 random words blanked out (shown as yellow boxes).</p>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl mb-3">2️⃣</div>
                                    <h4 class="font-semibold text-gray-900  mb-2">Select Words</h4>
                                    <p class="text-sm text-gray-700 ">Click on the correct words from the options below, filling from <strong>right to left</strong>.</p>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl mb-3">3️⃣</div>
                                    <h4 class="font-semibold text-gray-900  mb-2">Check Answer</h4>
                                    <p class="text-sm text-gray-700 ">Click "Check Answer" to verify if the words are in the correct order.</p>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-blue-50  border-l-4 border-blue-500 p-6 rounded">
                                <h4 class="text-lg font-bold text-blue-900  mb-3">💡 Tips for Success</h4>
                                <ul class="space-y-2 text-sm text-blue-800 ">
                                    <li>✓ Read the context to guess missing words</li>
                                    <li>✓ Order matters - words must match exactly</li>
                                    <li>✓ Fill from left-to-right across the blanks</li>
                                    <li>✓ Build familiarity with verse structure</li>
                                </ul>
                            </div>

                            <div class="bg-green-50  border-l-4 border-green-500 p-6 rounded">
                                <h4 class="text-lg font-bold text-green-900  mb-3">🎯 What You'll Learn</h4>
                                <ul class="space-y-2 text-sm text-green-800 ">
                                    <li>✓ Verse memorization through word recognition</li>
                                    <li>✓ Understanding verse flow and meaning</li>
                                    <li>✓ Recall ability with contextual hints</li>
                                    <li>✓ Build your Quran knowledge progressively</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Quiz Container -->
                    <div v-if="!selectedSurahs.length" class="text-center py-12">
                        <p class="text-gray-600 ">Please select some surahs from the configuration first</p>
                        <button @click="currentTab = 'config'" class="mt-4 text-primary hover:underline">
                            Go to Configuration
                        </button>
                    </div>

                    <div v-else-if="!completionVerse && isLoading" class="text-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
                        <p class="mt-4 text-gray-600 ">Loading question...</p>
                    </div>

                    <!-- Question Display -->
                    <div v-else-if="completionVerse" class="space-y-6">
                        <!-- Current Verse with Blanks -->
                        <div class="p-8 bg-gradient-to-br from-blue-50 to-indigo-50   rounded-xl border-4 border-blue-300  shadow-lg">
                            <div class="mb-4">
                                <p class="text-xs font-semibold text-blue-600  uppercase tracking-widest mb-2">📖 Current Verse</p>
                                <p class="text-sm text-blue-500  font-medium">
                                    Surah {{ completionVerse.chapter }}, Verse {{ completionVerse.verse }}
                                </p>
                            </div>
                            <div class="text-2xl text-right font-arabic text-blue-900 " style="line-height: 2.5;">
                                <span v-for="(word, index) in completionVerseDisplay || []" :key="index">
                                    <span v-if="word.isBlank" class="inline-block bg-yellow-200  text-yellow-900  px-2 py-1 rounded mx-1 min-w-[100px] text-center font-semibold">
                                        {{ getFilledWord(word.originalIndex) || '___' }}
                                    </span>
                                    <span v-else class="mx-1">
                                        {{ word.text }}
                                    </span>
                                </span>
                            </div>
                        </div>

                        <!-- Progress -->
                        <div v-if="!completionAnswerRevealed" class="bg-blue-50  border border-blue-200  rounded-lg p-4">
                            <p class="text-sm text-blue-900 ">
                                Words filled: {{ completionSelectedWords.length }} / {{ completionTotalMissing }}
                            </p>
                            <div class="w-full bg-blue-200  rounded-full h-2 mt-2">
                                <div class="bg-blue-600 h-2 rounded-full transition-all" :style="{ width: (completionTotalMissing ? (completionSelectedWords.length / completionTotalMissing * 100) : 0) + '%' }"></div>
                            </div>
                        </div>

                        <!-- Word Options -->
                        <div class="space-y-4">
                            <p class="text-sm font-medium text-gray-700 ">Select the correct words in order (right to left):</p>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                                <button v-for="(option, index) in (completionOptions || [])" 
                                    v-show="!completionSelectedWords.includes(index) || completionAnswerRevealed"
                                    :key="index"
                                    @click="selectCompletionWord(index)"
                                    :disabled="completionAnswerRevealed || completionSelectedWords.includes(index)"
                                    :class="[
                                        'p-3 rounded-lg font-arabic transition-colors border-2',
                                        completionSelectedWords.includes(index)
                                            ? 'bg-gray-300  border-gray-400 text-gray-600  cursor-not-allowed'
                                            : completionAnswerRevealed
                                                ? option?.isCorrect ? 'bg-green-100  border-green-500 text-green-700 ' : 'bg-gray-100  border-gray-300'
                                                : 'bg-white  border-gray-200  hover:border-primary hover:bg-blue-50 '
                                    ]">
                                    <p class="text-lg" style="line-height: 1.5;">{{ option?.text || '?' }}</p>
                                </button>
                            </div>
                        </div>

                        <!-- Selected Words Display -->
                        <div v-if="completionSelectedWords.length > 0 && !completionAnswerRevealed" class="bg-purple-50  border border-purple-200  rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-purple-900  mb-2">Words selected: {{ completionSelectedWords.length }} / {{ completionTotalMissing }}</p>
                                    <div class="flex flex-wrap gap-2">
                                        <span v-for="(wordIndex, position) in completionSelectedWords" :key="position" class="bg-purple-200  text-purple-900  px-3 py-1 rounded-full text-sm">
                                            {{ position + 1 }}. {{ (completionOptions && completionOptions[wordIndex]) ? completionOptions[wordIndex].text : '?' }}
                                        </span>
                                    </div>
                                </div>
                                <div v-if="completionSelectedWords.length === completionTotalMissing" class="text-right">
                                    <p class="text-sm text-purple-700  font-semibold animate-pulse">✓ Checking...</p>
                                </div>
                                <button v-else @click="checkCompletionAnswer" class="px-6 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 whitespace-nowrap">
                                    Check Answer
                                </button>
                            </div>
                        </div>

                        <!-- Result Display -->
                        <div v-if="completionAnswerRevealed" class="space-y-3">
                            <div v-if="completionIsCorrect" class="bg-green-50  border border-green-500 rounded-lg p-4">
                                <p class="text-green-700  font-semibold text-lg">✅ Correct! All words in the right order!</p>
                            </div>
                            <div v-else class="bg-red-50  border border-red-500 rounded-lg p-4">
                                <p class="text-red-700  font-semibold">❌ Incorrect order or words</p>
                                <div class="mt-3 text-right font-arabic">
                                    <p class="text-sm text-gray-600  mb-1">Correct order:</p>
                                    <p class="text-xl" style="line-height: 2;">{{ completionVerse.text }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="error" class="text-red-500 text-center mt-4">
                        {{ error }}
                    </div>
                </div>

                <!-- Test Continuation -->
                <div v-if="currentTab === 'multiple-choice'" class="space-y-6">
                    <!-- Header with Score -->
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-3xl font-bold text-primary mb-1">🔗 Test Continuation</h2>
                            <p class="text-gray-600 ">Select the next or previous verse correctly</p>
                            <!-- Start Button -->
                            <div v-if="!continuationVerse && !isLoading && selectedSurahs.length" class="mt-4">
                                <button @click="generateContinuationQuestion" class="px-6 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-lg font-bold hover:from-blue-600 hover:to-cyan-600 transition transform hover:scale-105">
                                    🚀 Start
                                </button>
                            </div>
                        </div>
                        
                        <!-- Score Display -->
                        <div class="text-right">
                            <div class="bg-gray-100  rounded-lg p-4">
                                <div class="mb-2">
                                    <p class="text-sm text-gray-600 ">Score</p>
                                    <p class="text-2xl font-bold text-primary">
                                        {{ continuationScore }}/{{ continuationAttempts }}
                                        <span class="text-sm text-gray-500">
                                            ({{ continuationAttempts ? Math.round((continuationScore/continuationAttempts) * 100) : 0 }}%)
                                        </span>
                                    </p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 ">Current Streak</p>
                                    <p class="text-xl font-bold" :class="continuationStreak >= 5 ? 'text-green-500' : 'text-gray-700 '">
                                        {{ continuationStreak }} 🔥
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tutorial Section (shown before quiz starts) -->
                    <div v-if="!continuationVerse && !isLoading && selectedSurahs.length" class="space-y-6">
                        <div class="bg-gradient-to-r from-blue-50 to-cyan-50   border-2 border-blue-200  rounded-lg p-8">
                            <h3 class="text-2xl font-bold text-blue-700  mb-4">How It Works 🎯</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="text-center">
                                    <div class="text-4xl mb-3">1️⃣</div>
                                    <h4 class="font-semibold text-gray-900  mb-2">See the Verse</h4>
                                    <p class="text-sm text-gray-700 ">A verse from the Quran is displayed with a badge showing if you need the <strong>Next</strong> or <strong>Previous</strong> verse.</p>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl mb-3">2️⃣</div>
                                    <h4 class="font-semibold text-gray-900  mb-2">Choose Wisely</h4>
                                    <p class="text-sm text-gray-700 ">Select from 4 options - one is correct, three are distractors from other verses.</p>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl mb-3">3️⃣</div>
                                    <h4 class="font-semibold text-gray-900  mb-2">Get Feedback</h4>
                                    <p class="text-sm text-gray-700 ">Immediately see if you're correct and learn the verse order in the Quran.</p>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-blue-50  border-l-4 border-blue-500 p-6 rounded">
                                <h4 class="text-lg font-bold text-blue-900  mb-3">💡 Tips for Success</h4>
                                <ul class="space-y-2 text-sm text-blue-800 ">
                                    <li>✓ Pay attention to the badge (Next ⬇️ or Previous ⬆️)</li>
                                    <li>✓ Recognize verse themes to spot distractors</li>
                                    <li>✓ Build sequential memory of the Quran</li>
                                    <li>✓ Speed comes with practice and familiarity</li>
                                </ul>
                            </div>

                            <div class="bg-green-50  border-l-4 border-green-500 p-6 rounded">
                                <h4 class="text-lg font-bold text-green-900  mb-3">🎯 What You'll Learn</h4>
                                <ul class="space-y-2 text-sm text-green-800 ">
                                    <li>✓ Verse sequence and progression in surahs</li>
                                    <li>✓ Recognize verse boundaries and transitions</li>
                                    <li>✓ Build structural memory of the Quran</li>
                                    <li>✓ Improve recitation accuracy</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Quiz Container -->
                    <div v-if="!selectedSurahs.length" class="text-center py-12">
                        <p class="text-gray-600 ">Please select some surahs from the configuration first</p>
                        <button @click="currentTab = 'config'" class="mt-4 text-primary hover:underline">
                            Go to Configuration
                        </button>
                    </div>

                    <div v-else-if="!continuationVerse && isLoading" class="text-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
                        <p class="mt-4 text-gray-600 ">Loading question...</p>
                    </div>

                    <!-- Question Display -->
                    <div v-else-if="continuationVerse" class="space-y-6">
                        <!-- Badge indicating Next or Previous -->
                        <div class="flex justify-center mb-4">
                            <span v-if="continuationType === 'next'" class="inline-block px-6 py-2 bg-blue-500 text-white rounded-full font-bold text-lg">
                                ⬇️ Find the NEXT verse
                            </span>
                            <span v-else class="inline-block px-6 py-2 bg-orange-500 text-white rounded-full font-bold text-lg">
                                ⬆️ Find the PREVIOUS verse
                            </span>
                        </div>

                        <!-- Current Verse -->
                        <div class="p-8 bg-gradient-to-br from-cyan-50 to-blue-50   rounded-xl border-4 border-cyan-300  shadow-lg">
                            <div class="mb-4">
                                <p class="text-xs font-semibold text-cyan-600  uppercase tracking-widest mb-2">📖 Current Verse</p>
                                <p class="text-sm text-cyan-500  font-medium">
                                    Surah {{ continuationVerse.chapter }}, Verse {{ continuationVerse.verse }}
                                </p>
                            </div>
                            <p class="text-2xl text-right font-arabic text-cyan-900 " style="line-height: 2;">{{ continuationVerse.text }}</p>
                        </div>

                        <!-- Options -->
                        <div class="grid gap-4">
                            <template v-if="!continuationAnswerRevealed">
                                <button v-for="(option, index) in continuationOptions" 
                                    :key="index"
                                    @click="checkContinuationAnswer(index)"
                                    class="p-4 rounded-lg text-right font-arabic transition-colors border-2 bg-white border-gray-200 hover:border-primary   ">
                                    <p class="text-2xl" style="line-height: 2;">{{ option.text }}</p>
                                </button>
                            </template>
                            <template v-else>
                                <!-- After answer selection -->
                                <div v-if="selectedWrongContinuation !== null" class="p-4 rounded-lg text-right font-arabic border-2 bg-red-50 border-red-500 ">
                                    <p class="text-2xl text-red-600 " style="line-height: 2;">
                                        {{ continuationOptions[selectedWrongContinuation].text }}
                                    </p>
                                    <p class="text-sm text-red-500  mt-2">
                                        ❌ Incorrect Answer (Verse {{ continuationOptions[selectedWrongContinuation].verse }})
                                    </p>
                                </div>
                                <div class="p-6 rounded-lg text-right font-arabic border-2 bg-green-50 border-green-500 ">
                                    <p class="text-2xl text-green-700 " style="line-height: 2;">
                                        {{ continuationOptions.find(opt => opt.isCorrect).text }}
                                    </p>
                                    <p class="text-sm text-green-600  mt-2">
                                        ✅ Correct Answer (Verse {{ continuationOptions.find(opt => opt.isCorrect).verse }})
                                    </p>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div v-if="error" class="text-red-500 text-center mt-4">
                        {{ error }}
                    </div>
                </div>

                <!-- Translation Match -->
                <div v-if="currentTab === 'translation-match'" class="space-y-6">
                    <!-- Header with Score -->
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-3xl font-bold text-primary mb-1">🌐 Translation Match</h2>
                            <p class="text-gray-600 ">Match Arabic verses to their English meanings</p>
                            <!-- Start Button -->
                            <div v-if="!currentVerse && !isLoading && selectedSurahs.length" class="mt-4">
                                <button @click="generateNewQuestion" class="px-6 py-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-lg font-bold hover:from-amber-600 hover:to-orange-600 transition transform hover:scale-105">
                                    🚀 Start
                                </button>
                            </div>
                        </div>
                        
                        <!-- Score Display -->
                        <div class="text-right">
                            <div class="bg-gray-100  rounded-lg p-4">
                                <div class="mb-2">
                                    <p class="text-sm text-gray-600 ">Score</p>
                                    <p class="text-2xl font-bold text-primary">
                                        {{ sessionScore }}/{{ sessionAttempts }}
                                        <span class="text-sm text-gray-500">
                                            ({{ sessionAttempts ? Math.round((sessionScore/sessionAttempts) * 100) : 0 }}%)
                                        </span>
                                    </p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 ">Current Streak</p>
                                    <p class="text-xl font-bold" :class="streak >= 5 ? 'text-green-500' : 'text-gray-700 '">
                                        {{ streak }} 🔥
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tutorial Section (shown before quiz starts) -->
                    <div v-if="!currentVerse && !isLoading && selectedSurahs.length" class="space-y-6">
                        <div class="bg-gradient-to-r from-amber-50 to-orange-50   border-2 border-amber-200  rounded-lg p-8">
                            <h3 class="text-2xl font-bold text-amber-700  mb-4">How It Works 🎯</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="text-center">
                                    <div class="text-4xl mb-3">1️⃣</div>
                                    <h4 class="font-semibold text-gray-900  mb-2">See Arabic Verse</h4>
                                    <p class="text-sm text-gray-700 ">A Quranic verse is displayed in beautiful Arabic script for you to understand.</p>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl mb-3">2️⃣</div>
                                    <h4 class="font-semibold text-gray-900  mb-2">Choose Translation</h4>
                                    <p class="text-sm text-gray-700 ">Select the correct English translation from 4 options - one correct, three distractors.</p>
                                </div>
                                <div class="text-center">
                                    <div class="text-4xl mb-3">3️⃣</div>
                                    <h4 class="font-semibold text-gray-900  mb-2">Learn Meaning</h4>
                                    <p class="text-sm text-gray-700 ">Build understanding of verse meanings and strengthen your knowledge of the Quran.</p>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-orange-50  border-l-4 border-orange-500 p-6 rounded">
                                <h4 class="text-lg font-bold text-orange-900  mb-3">💡 Tips for Success</h4>
                                <ul class="space-y-2 text-sm text-orange-800 ">
                                    <li>✓ Look for keywords and familiar themes</li>
                                    <li>✓ Pay attention to context clues in the verse</li>
                                    <li>✓ Note common translation phrases from the Quran</li>
                                    <li>✓ Eliminate obviously wrong answers first</li>
                                </ul>
                            </div>

                            <div class="bg-green-50  border-l-4 border-green-500 p-6 rounded">
                                <h4 class="text-lg font-bold text-green-900  mb-3">🎯 What You'll Learn</h4>
                                <ul class="space-y-2 text-sm text-green-800 ">
                                    <li>✓ Quranic verse meanings and interpretations</li>
                                    <li>✓ Common translation vocabulary and phrases</li>
                                    <li>✓ Deeper understanding of Islamic teachings</li>
                                    <li>✓ Tafsir concepts through context</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Quiz Container -->
                    <div v-if="!selectedSurahs.length" class="text-center py-12">
                        <p class="text-gray-600">Please select some surahs from the configuration first</p>
                        <button @click="currentTab = 'config'" class="mt-4 text-primary hover:underline">
                            Go to Configuration
                        </button>
                    </div>
                    <!-- Quiz Container -->
                    <div v-if="!selectedSurahs.length" class="text-center py-12">
                        <p class="text-gray-600 ">Please select some surahs from the configuration first</p>
                        <button @click="currentTab = 'config'" class="mt-4 text-primary hover:underline">
                            Go to Configuration
                        </button>
                    </div>

                    <div v-else-if="!currentVerse && isLoading" class="text-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
                        <p class="mt-4 text-gray-600 ">Loading question...</p>
                    </div>

                    <!-- Question Display -->
                    <div v-else-if="currentVerse" class="space-y-6">
                        <!-- Verse -->
                        <div class="p-8 bg-gradient-to-br from-amber-50 to-orange-50   rounded-xl border-4 border-amber-300  shadow-lg">
                            <div class="mb-4">
                                <p class="text-xs font-semibold text-amber-600  uppercase tracking-widest mb-2">📖 Current Verse</p>
                                <p class="text-sm text-amber-500  font-medium">
                                    Surah {{ currentVerse.chapter }}, Verse {{ currentVerse.verse }}
                                </p>
                            </div>
                            <p class="text-2xl text-right font-arabic text-amber-900 " style="line-height: 2;">{{ currentVerse.text }}</p>
                        </div>

                        <!-- Translation Options -->
                        <div class="grid gap-4">
                            <template v-if="!answerRevealed">
                                <!-- Before answer selection -->
                                <button v-for="(option, index) in translationOptions" 
                                    :key="index"
                                    @click="checkAnswer(index)"
                                    class="p-4 rounded-lg text-left transition-colors border-2 bg-white border-gray-200 hover:border-primary   ">
                                    <p class="text-lg">{{ option.text }}</p>
                                </button>
                            </template>
                            <template v-else>
                                <!-- After answer selection -->
                                <div v-if="selectedWrongAnswer !== null" class="p-4 rounded-lg text-left border-2 bg-red-50 border-red-500 ">
                                    <p class="text-lg text-red-600 ">
                                        {{ translationOptions[selectedWrongAnswer].text }}
                                    </p>
                                    <p class="text-sm text-red-500  mt-2">
                                        ❌ Incorrect Answer
                                    </p>
                                </div>
                                <div class="p-6 rounded-lg text-left border-2 bg-green-50 border-green-500 ">
                                    <p class="text-2xl font-medium text-green-700 ">
                                        {{ translationOptions.find(opt => opt.isCorrect).text }}
                                    </p>
                                    <p class="text-sm text-green-600  mt-2">
                                        ✅ Correct Answer
                                    </p>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Configuration -->
                <div v-if="currentTab === 'config'" class="space-y-8">
                    <!-- Header -->
                    <div>
                        <h2 class="text-3xl font-bold text-primary mb-1">⚙️ Quiz Settings</h2>
                        <p class="text-gray-600 ">Customize your learning experience</p>
                    </div>

                    <!-- Default Settings Card -->
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50   border-2 border-purple-200  rounded-lg p-6">
                        <h3 class="text-xl font-bold text-purple-900  mb-4">💾 Manage Defaults</h3>
                        <p class="text-gray-700  mb-4">Save and load your favorite surah selections for quick access</p>
                        <div class="flex flex-wrap gap-3">
                            <button @click="saveDefaultSettings" 
                                class="px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition transform hover:scale-105">
                                💾 Save Current as Default
                            </button>
                            <button @click="loadDefaultSettings" 
                                class="px-6 py-3 bg-gradient-to-r from-pink-500 to-pink-600 text-white rounded-lg font-semibold hover:from-pink-600 hover:to-pink-700 transition transform hover:scale-105">
                                📥 Load Default Selection
                            </button>
                        </div>
                    </div>

                    <!-- Surah Selection Card -->
                    <div class="bg-white  rounded-lg border-2 border-gray-200  p-6">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-900  mb-1">📚 Select Surahs</h3>
                                <p class="text-gray-600 ">Choose which surahs to practice. {{ selectedSurahs.length }} / {{ Object.keys(surahs).length }} selected</p>
                            </div>
                            <div class="bg-primary text-white rounded-lg px-4 py-2 text-center">
                                <p class="text-xs text-white/80">Selection</p>
                                <p class="text-2xl font-bold">{{ Math.round((selectedSurahs.length / Object.keys(surahs).length) * 100) }}%</p>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="flex flex-wrap gap-2 mb-6">
                            <button @click="toggleAllSurahs" 
                                class="px-4 py-2 rounded-lg font-semibold transition transform hover:scale-105"
                                :class="allSurahsSelected 
                                    ? 'bg-red-100  text-red-700  hover:bg-red-200' 
                                    : 'bg-green-100  text-green-700  hover:bg-green-200'">
                                {{ allSurahsSelected ? '✗ Deselect All' : '✓ Select All' }}
                            </button>
                            <button @click="saveConfig" 
                                class="px-4 py-2 bg-primary text-white rounded-lg font-semibold hover:bg-secondary transition transform hover:scale-105">
                                💾 Save Settings
                            </button>
                        </div>

                        <!-- Surah Grid -->
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            <div v-for="(name, number) in surahs" 
                                :key="number"
                                @click="toggleSurah(number)"
                                class="p-3 rounded-lg cursor-pointer transition-all transform hover:scale-105 border-2"
                                :class="selectedSurahs.includes(number) 
                                    ? 'bg-primary text-white border-primary shadow-lg' 
                                    : 'bg-gray-50  text-gray-900  border-gray-200  hover:border-primary'">
                                <div class="text-center">
                                    <p class="font-bold text-lg">{{ number }}</p>
                                    <p class="font-arabic text-sm leading-tight">{{ name }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Info Box -->
                    <div class="bg-blue-50  border-l-4 border-blue-500 p-6 rounded">
                        <h4 class="text-lg font-bold text-blue-900  mb-2">📖 Tips</h4>
                        <ul class="text-sm text-blue-800  space-y-1">
                            <li>✓ Select surahs you're currently memorizing</li>
                            <li>✓ Start with a few surahs, then expand gradually</li>
                            <li>✓ Your selection is saved automatically</li>
                            <li>✓ Use "Save as Default" to quickly restore your selection later</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white  border-t border-gray-200  mt-12">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex flex-col items-center justify-center gap-4">
                    <p class="text-center text-gray-600 text-sm font-medium">
                        Murajah Version 25.10.26
                    </p>
                    <a href="https://github.com/wasi0013/Murajah" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 text-gray-600 hover:text-blue-600 transition-colors">
                        <i class="fab fa-github text-lg"></i>
                        <span>View Source on GitHub</span>
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Database Setup -->
    <script>
        // IndexedDB Setup
        const QuizDB = {
            db: null,
            DB_NAME: 'MurajahQuizDB',
            VERSION: 1,

            // Store names
            STORES: {
                PROGRESS: 'quizProgress',
                SETTINGS: 'settings',
                SCORES: 'scores',
                BOOKMARKS: 'bookmarks'
            },

            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.DB_NAME, this.VERSION);

                    request.onerror = () => {
                        console.error('Failed to open database:', request.error);
                        reject(request.error);
                    };

                    request.onsuccess = () => {
                        this.db = request.result;
                        console.log('Database opened successfully');
                        resolve(this.db);
                    };

                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Quiz Progress Store
                        if (!db.objectStoreNames.contains(this.STORES.PROGRESS)) {
                            const progressStore = db.createObjectStore(this.STORES.PROGRESS, { keyPath: 'id', autoIncrement: true });
                            progressStore.createIndex('quizType', 'quizType', { unique: false });
                            progressStore.createIndex('timestamp', 'timestamp', { unique: false });
                        }

                        // Settings Store
                        if (!db.objectStoreNames.contains(this.STORES.SETTINGS)) {
                            db.createObjectStore(this.STORES.SETTINGS, { keyPath: 'key' });
                        }

                        // Scores Store
                        if (!db.objectStoreNames.contains(this.STORES.SCORES)) {
                            const scoresStore = db.createObjectStore(this.STORES.SCORES, { keyPath: 'id', autoIncrement: true });
                            scoresStore.createIndex('quizType', 'quizType', { unique: false });
                            scoresStore.createIndex('score', 'score', { unique: false });
                            scoresStore.createIndex('timestamp', 'timestamp', { unique: false });
                        }

                        // Bookmarks Store
                        if (!db.objectStoreNames.contains(this.STORES.BOOKMARKS)) {
                            const bookmarksStore = db.createObjectStore(this.STORES.BOOKMARKS, { keyPath: 'id', autoIncrement: true });
                            bookmarksStore.createIndex('type', 'type', { unique: false });
                            bookmarksStore.createIndex('reference', 'reference', { unique: false });
                        }
                    };
                });
            },

            // Generic CRUD operations
            async add(storeName, data) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(storeName, 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.add({ ...data, timestamp: Date.now() });

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            async get(storeName, id) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(storeName, 'readonly');
                    const store = transaction.objectStore(storeName);
                    const request = store.get(id);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            async getAll(storeName) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(storeName, 'readonly');
                    const store = transaction.objectStore(storeName);
                    const request = store.getAll();

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            async update(storeName, id, data) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(storeName, 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.put({ ...data, id, timestamp: Date.now() });

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            async delete(storeName, id) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(storeName, 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.delete(id);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            // Specific quiz operations
            async saveQuizProgress(quizType, data) {
                return this.add(this.STORES.PROGRESS, {
                    quizType,
                    ...data
                });
            },

            async getQuizProgress(quizType) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(this.STORES.PROGRESS, 'readonly');
                    const store = transaction.objectStore(this.STORES.PROGRESS);
                    const index = store.index('quizType');
                    const request = index.getAll(quizType);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            async saveScore(quizType, score, details = {}) {
                return this.add(this.STORES.SCORES, {
                    quizType,
                    score,
                    details
                });
            },

            async getScores(quizType) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(this.STORES.SCORES, 'readonly');
                    const store = transaction.objectStore(this.STORES.SCORES);
                    const index = store.index('quizType');
                    const request = index.getAll(quizType);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            async setSetting(key, value) {
                try {
                    // First try to delete any existing setting
                    try {
                        await this.delete(this.STORES.SETTINGS, key);
                    } catch (e) {
                        // Ignore delete errors
                    }
                    
                    // Then add the new setting
                    return await this.add(this.STORES.SETTINGS, { 
                        key, 
                        value: JSON.stringify(value),
                        timestamp: Date.now()
                    });
                } catch (err) {
                    console.error('Error saving setting:', err);
                    throw err;
                }
            },

            async getSetting(key) {
                try {
                    const setting = await this.get(this.STORES.SETTINGS, key);
                    if (setting) {
                        return {
                            ...setting,
                            value: JSON.parse(setting.value)
                        };
                    }
                    return null;
                } catch (err) {
                    console.error('Error getting setting:', err);
                    return null;
                }
            }
        };
    </script>

    <!-- Vue App Script -->
    <script>
        const { createApp, ref } = Vue

        createApp({
            setup() {
                const isDarkMode = ref(false)
                const currentTab = ref('lightning-round')
                const isLoading = ref(true)
                const error = ref(null)
                const surahs = ref({})
                const selectedSurahs = ref([])
                const allSurahsSelected = ref(false)
                const quranData = ref({})
                const translationData = ref({})
                const currentVerse = ref(null)
                const translationOptions = ref([])
                const answerRevealed = ref(false)
                const selectedWrongAnswer = ref(null)
                const sessionScore = ref(0)
                const sessionAttempts = ref(0)
                const streak = ref(0)

                // Test Continuation Quiz State
                const continuationVerse = ref(null)
                const continuationOptions = ref([])
                const continuationAnswerRevealed = ref(false)
                const selectedWrongContinuation = ref(null)
                const continuationScore = ref(0)
                const continuationAttempts = ref(0)
                const continuationStreak = ref(0)
                const continuationType = ref('next') // 'next' or 'previous'

                // Verse Completion Quiz State
                const completionVerse = ref(null)
                const completionVerseDisplay = ref([])
                const completionOptions = ref([])
                const completionSelectedWords = ref([])
                const completionAnswerRevealed = ref(false)
                const completionIsCorrect = ref(false)
                const completionScore = ref(0)
                const completionAttempts = ref(0)
                const completionStreak = ref(0)
                const completionCorrectAnswers = ref([])
                const completionTotalMissing = ref(0)
                const completionMissingCount = ref(0)
                const completionBlankIndices = ref([]) // Indices of blank words in verse
                const completionFilledWords = ref({}) // Map of blank position -> filled word

                // Lightning Round State
                const lightningSelectedTime = ref(null) // Selected time in seconds: 60, 120, 180, 300
                const lightningSelectedDifficulty = ref(null) // 'easy', 'medium', 'hard'
                const lightningTimeLeft = ref(0) // Current countdown in seconds
                const lightningTotalTime = ref(0) // Original selected time
                const lightningScore = ref(0) // Questions answered correctly
                const lightningAttempts = ref(0) // Total questions asked
                const lightningMistakesLeft = ref(0) // Mistakes remaining
                const lightningMaxMistakes = ref(0) // Max mistakes allowed based on difficulty
                const lightningIsActive = ref(false) // Is round currently running
                const lightningCurrentQuestion = ref(null) // Current question data
                const lightningCurrentQuestionType = ref(null) // 'continuation' or 'translation'
                const lightningOptions = ref([]) // Current question options
                const lightningAnswerRevealed = ref(false) // Has answer been revealed
                const lightningAnswerIsCorrect = ref(false) // Was answer correct
                const lightningTimerId = ref(null) // Store timer ID for cleanup
                const lightningRoundEnded = ref(false) // Has round ended
                const lightningTimeRemaining = ref(0) // Time remaining when round ended (for stats)

                // Load quiz data
                const loadQuizData = async () => {
                    try {
                        const [quranResponse, translationResponse] = await Promise.all([
                            fetch('resources/quran.json'),
                            fetch('resources/en.json')
                        ]);
                        quranData.value = await quranResponse.json();
                        translationData.value = await translationResponse.json();
                    } catch (err) {
                        console.error('Failed to load quiz data:', err);
                        error.value = 'Failed to load quiz data.';
                    }
                };

                // Detect touch device capability
                const isTouchDevice = () => {
                    return (
                        ('ontouchstart' in window) ||
                        (navigator.maxTouchPoints > 0) ||
                        (navigator.msMaxTouchPoints > 0) ||
                        window.matchMedia('(hover: none) and (pointer: coarse)').matches
                    );
                };

                // Disable tooltips on touch devices
                const disableTooltipsOnTouch = () => {
                    if (!isTouchDevice()) return;
                    
                    // Disable all mouseenter/mouseover tooltip triggers
                    document.addEventListener('mouseenter', (e) => {
                        e.preventDefault();
                    }, { capture: true });
                    
                    // Remove hover-based tooltips from all elements
                    const allElements = document.querySelectorAll('*[title], [data-tooltip], .tooltip, [role="tooltip"]');
                    allElements.forEach(el => {
                        el.removeAttribute('title');
                        el.style.pointerEvents = 'none';
                    });
                    
                    console.log('[Quiz] Tooltips disabled for touch device');
                };

                // Get random verses excluding current verse
                const getRandomVerses = (currentVerse, count) => {
                    const allVerses = [];
                    Object.keys(translationData.value).forEach(surahNum => {
                        Object.values(translationData.value[surahNum]).forEach(verse => {
                            if (verse.chapter !== currentVerse.chapter || verse.verse !== currentVerse.verse) {
                                allVerses.push(verse);
                            }
                        });
                    });
                    
                    const result = [];
                    while (result.length < count && allVerses.length > 0) {
                        const randomIndex = Math.floor(Math.random() * allVerses.length);
                        result.push(allVerses.splice(randomIndex, 1)[0]);
                    }
                    return result;
                };

                // Generate new question
                const generateNewQuestion = async () => {
                    if (!selectedSurahs.value.length) return;
                    
                    // Reset scores if this is a new session (no current verse)
                    if (!currentVerse.value) {
                        sessionScore.value = 0;
                        sessionAttempts.value = 0;
                        streak.value = 0;
                    }
                    
                    isLoading.value = true;
                    answerRevealed.value = false;
                    selectedWrongAnswer.value = null;
                    
                    try {
                        // Select random surah from selected ones
                        const randomSurahNum = selectedSurahs.value[
                            Math.floor(Math.random() * selectedSurahs.value.length)
                        ];
                        
                        // Get random verse from that surah
                        const surahVerses = quranData.value[randomSurahNum];
                        const randomVerseIndex = Math.floor(Math.random() * surahVerses.length);
                        const verseNumber = randomVerseIndex + 1;
                        
                        // Set current verse
                        currentVerse.value = {
                            chapter: parseInt(randomSurahNum),
                            verse: verseNumber,
                            text: surahVerses[randomVerseIndex].text
                        };

                        // Get correct translation
                        const correctTranslation = translationData.value[randomSurahNum].find(
                            v => v.verse === verseNumber
                        );

                        // Get 3 random wrong translations
                        const wrongTranslations = getRandomVerses(currentVerse.value, 3);

                        // Combine and shuffle options
                        const options = [
                            { text: correctTranslation.text, isCorrect: true },
                            ...wrongTranslations.map(t => ({ text: t.text, isCorrect: false }))
                        ];
                        
                        // Fisher-Yates shuffle
                        for (let i = options.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [options[i], options[j]] = [options[j], options[i]];
                        }

                        translationOptions.value = options;
                    } catch (err) {
                        console.error('Error generating question:', err);
                        error.value = 'Failed to generate question.';
                    } finally {
                        isLoading.value = false;
                    }
                };

                // Check answer
                const checkAnswer = async (index) => {
                    answerRevealed.value = true;
                    const isCorrect = translationOptions.value[index].isCorrect;
                    
                    if (!isCorrect) {
                        selectedWrongAnswer.value = index;
                    }
                    
                    // Update session score
                    sessionAttempts.value++;
                    if (isCorrect) {
                        sessionScore.value++;
                        streak.value++;
                    } else {
                        streak.value = 0;
                    }
                    
                    // Save score
                    try {
                        await QuizDB.saveScore('translation-match', isCorrect ? 1 : 0, {
                            surah: currentVerse.value.chapter,
                            verse: currentVerse.value.verse,
                            selectedAnswer: translationOptions.value[index].text,
                            streak: streak.value
                        });
                    } catch (err) {
                        console.error('Error saving score:', err);
                    }

                    // Auto-generate new question after delay
                    setTimeout(() => {
                        generateNewQuestion();
                    }, 3000);
                };

                // Load surahs data
                const loadSurahs = async () => {
                    try {
                        const response = await fetch('resources/surah-names.json')
                        const data = await response.json()
                        surahs.value = data
                        
                        // Load saved surah selection
                        const savedSelection = await QuizDB.getSetting('selectedSurahs')
                        if (savedSelection) {
                            selectedSurahs.value = savedSelection.value
                            updateAllSurahsState()
                        }
                    } catch (err) {
                        console.error('Failed to load surahs:', err)
                        error.value = 'Failed to load Surah list.'
                    }
                }

                // Toggle individual surah selection
                const toggleSurah = (number) => {
                    const index = selectedSurahs.value.indexOf(number)
                    if (index === -1) {
                        selectedSurahs.value.push(number)
                    } else {
                        selectedSurahs.value.splice(index, 1)
                    }
                    updateAllSurahsState()
                }

                // Update all surahs selected state
                const updateAllSurahsState = () => {
                    allSurahsSelected.value = selectedSurahs.value.length === Object.keys(surahs.value).length
                }

                // Toggle all surahs
                const toggleAllSurahs = () => {
                    if (allSurahsSelected.value) {
                        selectedSurahs.value = []
                    } else {
                        selectedSurahs.value = Object.keys(surahs.value)
                    }
                    updateAllSurahsState()
                }

                // Save configuration
                const saveConfig = async () => {
                    try {
                        await QuizDB.setSetting('selectedSurahs', selectedSurahs.value)
                        // Show success message
                        const prevError = error.value
                        error.value = 'Settings saved successfully!'
                        setTimeout(() => {
                            if (error.value === 'Settings saved successfully!') {
                                error.value = prevError
                            }
                        }, 2000)
                    } catch (err) {
                        console.error('Failed to save settings:', err)
                        error.value = 'Failed to save settings.'
                    }
                }

                // Save default settings
                const saveDefaultSettings = async () => {
                    try {
                        await QuizDB.setSetting('defaultSurahs', selectedSurahs.value)
                        // Show success message
                        const prevError = error.value
                        error.value = '✅ Default settings saved successfully!'
                        setTimeout(() => {
                            if (error.value === '✅ Default settings saved successfully!') {
                                error.value = prevError
                            }
                        }, 2000)
                    } catch (err) {
                        console.error('Failed to save default settings:', err)
                        error.value = 'Failed to save default settings.'
                    }
                }

                // Load default settings
                const loadDefaultSettings = async () => {
                    try {
                        const defaultSettings = await QuizDB.getSetting('defaultSurahs')
                        if (defaultSettings && defaultSettings.value) {
                            selectedSurahs.value = defaultSettings.value
                            updateAllSurahsState()
                            // Show success message
                            const prevError = error.value
                            error.value = '✅ Default settings loaded successfully!'
                            setTimeout(() => {
                                if (error.value === '✅ Default settings loaded successfully!') {
                                    error.value = prevError
                                }
                            }, 2000)
                        } else {
                            error.value = 'No default settings found. Please save settings as default first.'
                            setTimeout(() => {
                                error.value = null
                            }, 3000)
                        }
                    } catch (err) {
                        console.error('Failed to load default settings:', err)
                        error.value = 'Failed to load default settings.'
                    }
                }

                // Generate completion question
                const generateCompletionQuestion = async () => {
                    if (!selectedSurahs.value.length) return;
                    
                    // Reset scores if this is a new session
                    if (!completionVerse.value) {
                        completionScore.value = 0;
                        completionAttempts.value = 0;
                        completionStreak.value = 0;
                    }
                    
                    isLoading.value = true;
                    completionAnswerRevealed.value = false;
                    completionSelectedWords.value = [];
                    completionIsCorrect.value = false;
                    
                    try {
                        // Keep picking verses until we find one long enough
                        let verseText = '';
                        let words = [];
                        let randomSurahNum, randomVerseIndex, verseNumber;
                        let attempts = 0;
                        const maxAttempts = 10;
                        
                        while (words.length < 3 && attempts < maxAttempts) {
                            // Select random surah from selected ones
                            randomSurahNum = selectedSurahs.value[
                                Math.floor(Math.random() * selectedSurahs.value.length)
                            ];
                            
                            // Get verses for this surah
                            const surahVerses = quranData.value[randomSurahNum];
                            if (!surahVerses || surahVerses.length === 0) {
                                throw new Error('No verses found for selected surah');
                            }
                            
                            // Select a random verse
                            randomVerseIndex = Math.floor(Math.random() * surahVerses.length);
                            verseNumber = randomVerseIndex + 1;
                            verseText = surahVerses[randomVerseIndex].text;
                            
                            // Split verse into words
                            words = verseText.split(/\s+/).filter(w => w.length > 0);
                            attempts++;
                        }
                        
                        // If we couldn't find a long enough verse, use the shortest one we found
                        if (words.length < 3) {
                            console.warn(`Could not find verse with 3+ words after ${maxAttempts} attempts. Using shorter verse.`);
                        }
                        
                        // Determine how many words to blank (between 2-5)
                        const blankCount = Math.floor(2 + Math.random() * 4); // Random between 2-5
                        
                        // Randomly select which words to blank
                        const blankIndices = new Set();
                        while (blankIndices.size < blankCount) {
                            blankIndices.add(Math.floor(Math.random() * words.length));
                        }
                        
                        // Create display array with blanks
                        const display = words.map((word, index) => ({
                            text: word,
                            isBlank: blankIndices.has(index),
                            originalIndex: index
                        }));
                        
                        // Get correct answers in RIGHT-TO-LEFT order (highest index to lowest)
                        // This represents reading from right to left in Arabic
                        const correctAnswersArray = Array.from(blankIndices)
                            .sort((a, b) => b - a) // Sort in descending order (right to left)
                            .map(index => words[index]);
                        
                        completionVerse.value = {
                            chapter: parseInt(randomSurahNum),
                            verse: verseNumber,
                            text: verseText
                        };
                        
                        completionVerseDisplay.value = display;
                        completionCorrectAnswers.value = correctAnswersArray;
                        // Store blank indices in RIGHT-TO-LEFT order for visual filling and answer validation
                        // Highest index first (rightmost blank) = position 0
                        // Lowest index last (leftmost blank) = last position
                        completionBlankIndices.value = Array.from(blankIndices).sort((a, b) => b - a);
                        completionFilledWords.value = {}; // Reset filled words map
                        completionTotalMissing.value = blankCount;
                        completionMissingCount.value = 0;
                        
                        // Get random wrong words from other verses
                        const wrongWords = new Set();
                        const allWords = [];
                        const correctAnswersSet = new Set(correctAnswersArray); // Use Set for O(1) lookup
                        
                        Object.keys(quranData.value).forEach(surahKey => {
                            quranData.value[surahKey].forEach(verse => {
                                verse.text.split(/\s+/).filter(w => w.length > 0).forEach(word => {
                                    if (!correctAnswersSet.has(word)) {
                                        allWords.push(word);
                                    }
                                });
                            });
                        });
                        
                        // Add wrong words until we have enough
                        // Limit iterations to prevent infinite loop
                        const maxWrongWordsNeeded = blankCount * 2;
                        const maxIterations = Math.min(allWords.length, maxWrongWordsNeeded * 10);
                        let iterations = 0;
                        
                        while (wrongWords.size < maxWrongWordsNeeded && iterations < maxIterations) {
                            const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                            if (randomWord && !correctAnswersSet.has(randomWord)) {
                                wrongWords.add(randomWord);
                            }
                            iterations++;
                        }
                        
                        // Combine and shuffle options
                        const options = [
                            ...correctAnswersArray.map(word => ({ text: word, isCorrect: true })),
                            ...Array.from(wrongWords).map(word => ({ text: word, isCorrect: false }))
                        ];
                        
                        // Fisher-Yates shuffle
                        for (let i = options.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [options[i], options[j]] = [options[j], options[i]];
                        }
                        
                        completionOptions.value = options;
                    } catch (err) {
                        console.error('Error generating completion question:', err);
                        error.value = 'Failed to generate question.';
                    } finally {
                        isLoading.value = false;
                    }
                };

                // Helper function to get the word filled at a specific blank position
                const getFilledWord = (verseWordIndex) => {
                    // Guard checks
                    if (!completionBlankIndices.value || completionBlankIndices.value.length === 0) {
                        return null;
                    }
                    
                    // Find position in RIGHT-TO-LEFT sequence (highest index = position 0 = rightmost blank)
                    const positionInRTLSequence = completionBlankIndices.value.indexOf(verseWordIndex);
                    if (positionInRTLSequence === -1) return null; // Not a blank position
                    
                    // REVERSE mapping: get the word from the opposite end of the selection array
                    // This ensures first click fills rightmost blank VISUALLY
                    const reversedPosition = (completionBlankIndices.value.length - 1) - positionInRTLSequence;
                    const selectedWordIndex = completionSelectedWords.value[reversedPosition];
                    if (selectedWordIndex === undefined || selectedWordIndex === null) return null;
                    
                    const option = completionOptions.value[selectedWordIndex];
                    return option && option.text ? option.text : null;
                };

                // Select a completion word
                const selectCompletionWord = (index) => {
                    if (!completionSelectedWords.value.includes(index)) {
                        completionSelectedWords.value.push(index);
                        completionMissingCount.value++;
                        
                        // Auto-check answer when all words are selected
                        if (completionSelectedWords.value.length === completionTotalMissing.value) {
                            setTimeout(() => {
                                checkCompletionAnswer();
                            }, 300); // Small delay for visual feedback
                        }
                    }
                };

                // Check completion answer
                const checkCompletionAnswer = async () => {
                    completionAnswerRevealed.value = true;
                    
                    // Check if selected words match correct answers in REVERSED order
                    // Since we use reversed mapping for display, we need to reverse the selected words too
                    const reversedSelectedIndices = completionSelectedWords.value.slice().reverse();
                    const selectedWordsText = reversedSelectedIndices.map(i => completionOptions.value[i].text);
                    const isCorrect = selectedWordsText.length === completionCorrectAnswers.value.length &&
                                     selectedWordsText.every((word, i) => word === completionCorrectAnswers.value[i]);
                    
                    completionIsCorrect.value = isCorrect;
                    
                    // Update session score
                    completionAttempts.value++;
                    if (isCorrect) {
                        completionScore.value++;
                        completionStreak.value++;
                    } else {
                        completionStreak.value = 0;
                    }
                    
                    // Save score
                    try {
                        await QuizDB.saveScore('verse-completion', isCorrect ? 1 : 0, {
                            surah: completionVerse.value.chapter,
                            verse: completionVerse.value.verse,
                            missingWords: completionCorrectAnswers.value.length,
                            selectedCorrectly: isCorrect,
                            streak: completionStreak.value
                        });
                    } catch (err) {
                        console.error('Error saving score:', err);
                    }

                    // Auto-generate new question after delay
                    setTimeout(() => {
                        generateCompletionQuestion();
                    }, 3000);
                };

                // Generate continuation question
                const generateContinuationQuestion = async () => {
                    if (!selectedSurahs.value.length) return;
                    
                    // Reset scores if this is a new session
                    if (!continuationVerse.value) {
                        continuationScore.value = 0;
                        continuationAttempts.value = 0;
                        continuationStreak.value = 0;
                    }
                    
                    isLoading.value = true;
                    continuationAnswerRevealed.value = false;
                    selectedWrongContinuation.value = null;
                    
                    try {
                        // Select random surah from selected ones
                        const randomSurahNum = selectedSurahs.value[
                            Math.floor(Math.random() * selectedSurahs.value.length)
                        ];
                        
                        // Get verses for this surah
                        const surahVerses = quranData.value[randomSurahNum];
                        if (!surahVerses || surahVerses.length === 0) {
                            throw new Error('No verses found for selected surah');
                        }
                        
                        // Select a verse that has BOTH next and previous (not first, not last)
                        // This ensures any question type (next or previous) is valid
                        const selectedVerseIndex = 1 + Math.floor(Math.random() * (surahVerses.length - 2));
                        
                        // NOW decide randomly if asking for next or previous
                        continuationType.value = Math.random() < 0.5 ? 'next' : 'previous';
                        
                        const verseNumber = selectedVerseIndex + 1;
                        
                        // Set current verse
                        continuationVerse.value = {
                            chapter: parseInt(randomSurahNum),
                            verse: verseNumber,
                            text: surahVerses[selectedVerseIndex].text
                        };

                        // Determine correct answer verse index based on question type
                        const correctVerseIndex = continuationType.value === 'next' 
                            ? selectedVerseIndex + 1 
                            : selectedVerseIndex - 1;

                        // Create options
                        const options = [];
                        
                        // Add correct answer
                        options.push({
                            text: surahVerses[correctVerseIndex].text,
                            verse: correctVerseIndex + 1,  // Display number (1-based)
                            isCorrect: true
                        });

                        console.log('🟦 QUESTION GENERATED:');
                        console.log('  Type (badge):', continuationType.value);
                        console.log('  Display Verse Index:', selectedVerseIndex, '(shows verse', selectedVerseIndex + 1, ')');
                        console.log('  Correct Verse Index:', correctVerseIndex, '(verse', correctVerseIndex + 1, ')');
                        console.log('  Correct answer text:', surahVerses[correctVerseIndex].text);
                        console.log('  Correct answer object:', options[0]);

                        // Add wrong answers from different verses (avoid adjacent verses)
                        const usedIndices = new Set([selectedVerseIndex, correctVerseIndex]);
                        while (options.length < 4) {
                            const randomIndex = Math.floor(Math.random() * surahVerses.length);
                            if (!usedIndices.has(randomIndex)) {
                                usedIndices.add(randomIndex);
                                options.push({
                                    text: surahVerses[randomIndex].text,
                                    verse: randomIndex + 1,
                                    isCorrect: false
                                });
                            }
                        }

                        // Fisher-Yates shuffle
                        for (let i = options.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [options[i], options[j]] = [options[j], options[i]];
                        }

                        continuationOptions.value = options;
                    } catch (err) {
                        console.error('Error generating continuation question:', err);
                        error.value = 'Failed to generate question.';
                    } finally {
                        isLoading.value = false;
                    }
                };

                // Check continuation answer
                const checkContinuationAnswer = async (index) => {
                    continuationAnswerRevealed.value = true;
                    const isCorrect = continuationOptions.value[index].isCorrect;
                    
                    console.log('🟩 ANSWER SUBMITTED:');
                    console.log('  Selected option index:', index);
                    console.log('  Selected option text:', continuationOptions.value[index].text);
                    console.log('  Selected option verse:', continuationOptions.value[index].verse);
                    console.log('  isCorrect flag:', isCorrect);
                    console.log('  Correct answer was:', continuationOptions.value.find(opt => opt.isCorrect));
                    
                    if (!isCorrect) {
                        selectedWrongContinuation.value = index;
                    }
                    
                    // Update session score
                    continuationAttempts.value++;
                    if (isCorrect) {
                        continuationScore.value++;
                        continuationStreak.value++;
                    } else {
                        continuationStreak.value = 0;
                    }
                    
                    // Save score
                    try {
                        await QuizDB.saveScore('test-continuation', isCorrect ? 1 : 0, {
                            surah: continuationVerse.value.chapter,
                            verse: continuationVerse.value.verse,
                            type: continuationType.value,
                            selectedVerse: continuationOptions.value[index].verse,
                            correctVerse: continuationOptions.value.find(opt => opt.isCorrect).verse,
                            streak: continuationStreak.value
                        });
                    } catch (err) {
                        console.error('Error saving score:', err);
                    }

                    // Auto-generate new question after delay
                    setTimeout(() => {
                        generateContinuationQuestion();
                    }, 3000);
                };

                // Lightning Round Functions
                const startLightningRound = async () => {
                    if (!lightningSelectedTime.value || !lightningSelectedDifficulty.value) return;
                    
                    // Initialize round
                    lightningTimeLeft.value = lightningSelectedTime.value;
                    lightningTotalTime.value = lightningSelectedTime.value;
                    lightningScore.value = 0;
                    lightningAttempts.value = 0;
                    lightningIsActive.value = true;
                    lightningRoundEnded.value = false;
                    lightningAnswerRevealed.value = false;
                    
                    // Set mistake limits based on difficulty
                    if (lightningSelectedDifficulty.value === 'easy') {
                        lightningMaxMistakes.value = Infinity;
                        lightningMistakesLeft.value = Infinity;
                    } else if (lightningSelectedDifficulty.value === 'medium') {
                        lightningMaxMistakes.value = 3;
                        lightningMistakesLeft.value = 3;
                    } else { // hard
                        lightningMaxMistakes.value = 1;
                        lightningMistakesLeft.value = 1;
                    }
                    
                    // Start countdown timer
                    lightningTimerId.value = setInterval(() => {
                        lightningTimeLeft.value--;
                        
                        if (lightningTimeLeft.value <= 0) {
                            endLightningRound();
                        }
                    }, 1000);
                    
                    // Generate first question
                    await generateLightningQuestion();
                };

                const generateLightningQuestion = async () => {
                    if (!lightningIsActive.value || !selectedSurahs.value.length) return;
                    
                    lightningAnswerRevealed.value = false;
                    lightningAnswerIsCorrect.value = false;
                    
                    try {
                        // Randomly pick between continuation and translation
                        lightningCurrentQuestionType.value = Math.random() < 0.5 ? 'continuation' : 'translation';
                        
                        if (lightningCurrentQuestionType.value === 'continuation') {
                            await generateLightningContinuationQuestion();
                        } else {
                            await generateLightningTranslationQuestion();
                        }
                    } catch (err) {
                        console.error('Error generating lightning question:', err);
                    }
                };

                const generateLightningContinuationQuestion = async () => {
                    try {
                        const randomSurahNum = selectedSurahs.value[
                            Math.floor(Math.random() * selectedSurahs.value.length)
                        ];
                        
                        const surahVerses = quranData.value[randomSurahNum];
                        if (!surahVerses || surahVerses.length === 0) {
                            throw new Error('No verses found');
                        }
                        
                        // Select a verse that has BOTH next and previous (not first, not last)
                        const selectedVerseIndex = 1 + Math.floor(Math.random() * (surahVerses.length - 2));
                        
                        // NOW decide randomly if asking for next or previous
                        const continuationType = Math.random() < 0.5 ? 'next' : 'previous';
                        
                        const verseNumber = selectedVerseIndex + 1;
                        lightningCurrentQuestion.value = {
                            chapter: parseInt(randomSurahNum),
                            verse: verseNumber,
                            text: surahVerses[selectedVerseIndex].text,
                            type: continuationType
                        };
                        
                        const correctVerseIndex = continuationType === 'next' 
                            ? selectedVerseIndex + 1 
                            : selectedVerseIndex - 1;
                        
                        const options = [];
                        options.push({
                            text: surahVerses[correctVerseIndex].text,
                            verse: correctVerseIndex + 1,
                            isCorrect: true
                        });
                        
                        const usedIndices = new Set([selectedVerseIndex, correctVerseIndex]);
                        while (options.length < 4) {
                            const randomIndex = Math.floor(Math.random() * surahVerses.length);
                            if (!usedIndices.has(randomIndex)) {
                                options.push({
                                    text: surahVerses[randomIndex].text,
                                    verse: randomIndex + 1,
                                    isCorrect: false
                                });
                                usedIndices.add(randomIndex);
                            }
                        }
                        
                        // Fisher-Yates shuffle
                        for (let i = options.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [options[i], options[j]] = [options[j], options[i]];
                        }
                        
                        lightningOptions.value = options;
                    } catch (err) {
                        console.error('Error generating continuation question:', err);
                    }
                };

                const generateLightningTranslationQuestion = async () => {
                    try {
                        const randomSurahNum = selectedSurahs.value[
                            Math.floor(Math.random() * selectedSurahs.value.length)
                        ];
                        
                        const surahVerses = quranData.value[randomSurahNum];
                        const randomVerseIndex = Math.floor(Math.random() * surahVerses.length);
                        const verseNumber = randomVerseIndex + 1;
                        
                        lightningCurrentQuestion.value = {
                            chapter: parseInt(randomSurahNum),
                            verse: verseNumber,
                            text: surahVerses[randomVerseIndex].text,
                            type: 'translation'
                        };
                        
                        const correctTranslation = translationData.value[randomSurahNum].find(
                            v => v.verse === verseNumber
                        );
                        
                        const wrongTranslations = getRandomVerses(lightningCurrentQuestion.value, 3);
                        
                        const options = [
                            { text: correctTranslation.text, isCorrect: true },
                            ...wrongTranslations.map(t => ({ text: t.text, isCorrect: false }))
                        ];
                        
                        // Fisher-Yates shuffle
                        for (let i = options.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [options[i], options[j]] = [options[j], options[i]];
                        }
                        
                        lightningOptions.value = options;
                    } catch (err) {
                        console.error('Error generating translation question:', err);
                    }
                };

                const checkLightningAnswer = (index) => {
                    if (!lightningIsActive.value || lightningAnswerRevealed.value) return;
                    
                    lightningAnswerRevealed.value = true;
                    const isCorrect = lightningOptions.value[index].isCorrect;
                    lightningAnswerIsCorrect.value = isCorrect;
                    
                    // Update stats
                    lightningAttempts.value++;
                    if (isCorrect) {
                        lightningScore.value++;
                    } else {
                        if (lightningMistakesLeft.value !== Infinity) {
                            lightningMistakesLeft.value--;
                        }
                        
                        // Check if round should end
                        if (lightningMistakesLeft.value < 0 || (lightningSelectedDifficulty.value === 'hard' && !isCorrect)) {
                            setTimeout(() => {
                                endLightningRound();
                            }, 500);
                            return;
                        }
                    }
                    
                    // Auto-generate next question after 500ms
                    setTimeout(() => {
                        if (lightningIsActive.value) {
                            generateLightningQuestion();
                        }
                    }, 500);
                };

                const endLightningRound = () => {
                    lightningIsActive.value = false;
                    lightningRoundEnded.value = true;
                    lightningTimeRemaining.value = lightningTimeLeft.value;
                    
                    if (lightningTimerId.value) {
                        clearInterval(lightningTimerId.value);
                    }
                };

                const resetLightningRound = () => {
                    lightningSelectedTime.value = null;
                    lightningSelectedDifficulty.value = null;
                    lightningTimeLeft.value = 0;
                    lightningTotalTime.value = 0;
                    lightningScore.value = 0;
                    lightningAttempts.value = 0;
                    lightningMistakesLeft.value = 0;
                    lightningMaxMistakes.value = 0;
                    lightningIsActive.value = false;
                    lightningCurrentQuestion.value = null;
                    lightningCurrentQuestionType.value = null;
                    lightningOptions.value = [];
                    lightningAnswerRevealed.value = false;
                    lightningAnswerIsCorrect.value = false;
                    lightningRoundEnded.value = false;
                    lightningTimeRemaining.value = 0;
                    
                    if (lightningTimerId.value) {
                        clearInterval(lightningTimerId.value);
                    }
                };

                const saveLightningScore = async () => {
                    try {
                        const accuracy = lightningAttempts.value > 0 
                            ? Math.round((lightningScore.value / lightningAttempts.value) * 100) 
                            : 0;
                        
                        await QuizDB.saveScore('lightning-round', lightningScore.value, {
                            difficulty: lightningSelectedDifficulty.value,
                            totalTime: lightningTotalTime.value,
                            timeRemaining: lightningTimeRemaining.value,
                            questionsAnswered: lightningAttempts.value,
                            accuracy: accuracy,
                            correctAnswers: lightningScore.value
                        });
                        
                        error.value = '✅ Score saved successfully!';
                        setTimeout(() => {
                            error.value = null;
                        }, 3000);
                    } catch (err) {
                        console.error('Failed to save lightning score:', err);
                        error.value = 'Failed to save score.';
                    }
                };

                const tabs = ref([
                    { id: 'lightning-round', name: '⚡ Lightning Round' },
                    { id: 'verse-completion', name: 'Verse Completion' },
                    { id: 'multiple-choice', name: 'Test Continuation' },
                    { id: 'translation-match', name: 'Translation Match' },
                    { id: 'config', name: '⚙️ Settings' }
                ])

                // Initialize database and load settings
                const initializeApp = async () => {
                    try {
                        await QuizDB.init()
                        
                        // Always use light mode
                        isDarkMode.value = false
                        applyThemeToDOM('light')

                        // Load last active tab
                        const lastTab = await QuizDB.getSetting('lastTab')
                        if (lastTab) {
                            currentTab.value = lastTab.value
                        }

                        isLoading.value = false
                    } catch (err) {
                        console.error('Failed to initialize app:', err)
                        error.value = 'Failed to load app settings. Please refresh the page.'
                        isLoading.value = false
                    }
                }

                // Apply theme to DOM elements - Always light mode
                const applyThemeToDOM = (theme) => {
                    // Always apply light mode
                    document.documentElement.classList.remove('dark')
                    document.documentElement.classList.remove('dark-mode')
                    document.body.classList.remove('dark')
                    document.body.classList.remove('dark-mode')
                    document.documentElement.style.backgroundColor = '#ffffff'
                    document.documentElement.style.color = '#111827'
                    document.body.style.backgroundColor = '#ffffff'
                    document.body.style.color = '#111827'
                    console.log('[Quiz] Light mode applied to DOM')
                }

                // Toggle dark mode disabled - always use light mode
                const toggleDarkMode = async () => {
                    console.log('[Quiz] Dark mode toggle disabled - light mode is always active')
                }

                // Handle tab changes and save last active tab
                const changeTab = async (tabId) => {
                    // Prevent tab switching during active lightning round
                    if (lightningIsActive.value) {
                        error.value = '⚠️ Cannot switch tabs during an active Lightning Round. Finish or reset the round first.'
                        setTimeout(() => {
                            error.value = null
                        }, 3000)
                        return
                    }
                    
                    currentTab.value = tabId
                    try {
                        await QuizDB.setSetting('lastTab', tabId)
                    } catch (err) {
                        console.error('Failed to save last active tab:', err)
                    }
                }

                // Cleanup function for Lightning Round on unmount or before tab switch
                const cleanupLightningRound = () => {
                    if (lightningTimerId.value) {
                        clearInterval(lightningTimerId.value)
                        lightningTimerId.value = null
                    }
                    if (lightningIsActive.value) {
                        endLightningRound()
                    }
                }
                // Initialize app when component mounts
                const init = async () => {
                    await initializeApp()
                    await loadSurahs()
                    await loadQuizData() // Load quiz data after initialization
                    disableTooltipsOnTouch() // Disable tooltips on touch devices
                }
                init()

                return {
                    isDarkMode,
                    currentTab,
                    tabs,
                    isLoading,
                    error,
                    surahs,
                    selectedSurahs,
                    allSurahsSelected,
                    quranData,
                    translationData,
                    currentVerse,
                    translationOptions,
                    answerRevealed,
                    selectedWrongAnswer,
                    sessionScore,
                    sessionAttempts,
                    streak,
                    continuationVerse,
                    continuationOptions,
                    continuationAnswerRevealed,
                    selectedWrongContinuation,
                    continuationScore,
                    continuationAttempts,
                    continuationStreak,
                    continuationType,
                    completionVerse,
                    completionVerseDisplay,
                    completionOptions,
                    completionSelectedWords,
                    completionAnswerRevealed,
                    completionIsCorrect,
                    completionScore,
                    completionAttempts,
                    completionStreak,
                    completionTotalMissing,
                    completionMissingCount,
                    completionBlankIndices,
                    completionFilledWords,
                    toggleDarkMode,
                    applyThemeToDOM,
                    changeTab,
                    toggleSurah,
                    toggleAllSurahs,
                    saveConfig,
                    saveDefaultSettings,
                    loadDefaultSettings,
                    generateNewQuestion,
                    checkAnswer,
                    generateContinuationQuestion,
                    checkContinuationAnswer,
                    generateCompletionQuestion,
                    selectCompletionWord,
                    checkCompletionAnswer,
                    getFilledWord,
                    lightningSelectedTime,
                    lightningSelectedDifficulty,
                    lightningTimeLeft,
                    lightningTotalTime,
                    lightningScore,
                    lightningAttempts,
                    lightningMistakesLeft,
                    lightningMaxMistakes,
                    lightningIsActive,
                    lightningCurrentQuestion,
                    lightningCurrentQuestionType,
                    lightningOptions,
                    lightningAnswerRevealed,
                    lightningAnswerIsCorrect,
                    lightningRoundEnded,
                    startLightningRound,
                    generateLightningQuestion,
                    checkLightningAnswer,
                    endLightningRound,
                    resetLightningRound,
                    saveLightningScore,
                    cleanupLightningRound
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
